<!DOCTYPE html>
<html>
<head>
    <title>Database Admin</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .section { background: #f0f0f0; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; }
        .danger { background: #d32f2f; }
        pre { background: #fff; padding: 10px; border: 1px solid #ddd; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Database Admin Panel</h1>
    
    <div class="section">
        <h3>Database Status</h3>
        <p><strong>Database Engine:</strong> {{ db_info.engine }}</p>
        <p><strong>Database Name:</strong> {{ db_info.name }}</p>
        <p><strong>Total Users:</strong> {{ user_count }}</p>
        <p><strong>Total Accounts:</strong> {{ account_count }}</p>
        <p><strong>Total Lines:</strong> {{ line_count }}</p>
        
        {% if account_count == 0 %}
        <p class="warning">⚠️ No accounts found - consider populating sample data</p>
        {% elif account_count < 10 %}
        <p class="warning">⚠️ Only {{ account_count }} accounts - consider populating 100 accounts for testing</p>
        {% else %}
        <p class="success">✅ Database has {{ account_count }} accounts with {{ line_count }} lines</p>
        {% endif %}
    </div>
    
    {% if users %}
    <div class="section">
        <h3>All Users in Database</h3>
        <ul>
        {% for user in users %}
            <li><strong>{{ user.username }}</strong> (ID: {{ user.id }}, Active: {{ user.is_active }}, Staff: {{ user.is_staff }}, Email: {{ user.email }})</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if not sm_user_exists %}
    <div class="section error">
        <h3>❌ User 'sm' Not Found</h3>
        <p>The user 'sm' does not exist in the production database.</p>
        
        <form method="post" action="/database-admin/">
            {% csrf_token %}
            <input type="hidden" name="action" value="create_sm_user">
            <button type="submit">Create 'sm' User</button>
        </form>
    </div>
    {% else %}
    <div class="section success">
        <h3>✅ User 'sm' Found</h3>
        <p>User details:</p>
        <ul>
            <li>Username: {{ sm_user.username }}</li>
            <li>Email: {{ sm_user.email }}</li>
            <li>Active: {{ sm_user.is_active }}</li>
            <li>Staff: {{ sm_user.is_staff }}</li>
            <li>Superuser: {{ sm_user.is_superuser }}</li>
        </ul>
        
        <form method="post" action="/database-admin/">
            {% csrf_token %}
            <input type="hidden" name="action" value="reset_sm_password">
            <button type="submit">Reset 'sm' Password</button>
        </form>
    </div>
    {% endif %}
    
    {% if message %}
    <div class="section {{ message_type }}">
        <h3>{{ message_type|title }} Message</h3>
        <p>{{ message }}</p>
    </div>
    {% endif %}
    
    <div class="section">
        <h3>Database Actions</h3>
        
        <form method="post" action="/database-admin/" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="action" value="run_migrations">
            <button type="submit">Run Migrations</button>
        </form>
        
        <form method="post" action="/database-admin/" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="action" value="populate_sample_data">
            <button type="submit">Populate Sample Data</button>
        </form>
        
        <form method="post" action="/database-admin/" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="action" value="populate_100_accounts">
            <button type="submit" class="danger" onclick="return confirm('This will create 100 accounts with sample data. Continue?')">Populate 100 Accounts</button>
        </form>
        
        <p><small><strong>Note:</strong> "Populate 100 Accounts" creates realistic account data with lines, services, and billing information for testing purposes.</small></p>
    </div>
    
    <p><a href="/debug-login/">Back to Debug Login</a> | <a href="/login/">Regular Login</a></p>
</body>
</html>
